# Web.Casa 开发任务表

> 版本: 1.0 | 日期: 2026-02-28

---

## 总体开发阶段

```
Phase 0: 插件框架基础         (2-3 周)  ← 最核心，Pro 的基石
Phase 1: Docker 管理插件      (2-3 周)  ← 其他插件的基础设施
Phase 2: 项目部署插件         (2-3 周)  ← MVP 核心功能
Phase 3: AI 助手插件          (1-2 周)  ← 差异化核心
Phase 4: 文件管理 + 终端      (1-2 周)
Phase 5: 数据库管理插件       (1-2 周)
Phase 6: 备份 + 监控          (2-3 周)
Phase 7: 应用商店 + 模板市场  (2-3 周)
Phase 8: MCP Server + 体验打磨(2-3 周)
                              --------
                              ~16-22 周 (全量)
```

---

## Phase 0: 插件框架基础

> 目标: 建立插件系统，使现有 Lite 功能不受影响，Pro 功能可通过插件渐进添加

### 0.1 后端插件框架

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 0.1.1 | 定义 Plugin 接口 | 创建 `internal/plugin/types.go`，定义 Plugin interface、Metadata、PluginContext 等核心类型 | 0.5d |
| 0.1.2 | 实现 Plugin Manager | 创建 `internal/plugin/manager.go`，实现注册、依赖拓扑排序、初始化、启停等生命周期管理 | 1d |
| 0.1.3 | 实现 EventBus | 创建 `internal/plugin/eventbus.go`，实现 pub/sub 内存事件总线 | 0.5d |
| 0.1.4 | 实现 CoreAPI | 创建 `internal/plugin/coreapi.go`，封装核心功能供插件调用 (CreateHost/ReloadCaddy 等) | 1d |
| 0.1.5 | 实现 ConfigStore | 插件配置读写，基于 settings 表 `plugin.{id}.{key}` | 0.5d |
| 0.1.6 | 插件路由注册 | 在 Gin Router 上实现动态路由组 `/api/plugins/{id}/` | 0.5d |
| 0.1.7 | 插件数据表迁移 | 支持插件在 Init 时注册 GORM model，自动迁移到 `plugin_{id}_*` 表 | 0.5d |
| 0.1.8 | main.go 集成 | 在 main.go 中初始化 PluginManager，调用 InitAll/StartAll | 0.5d |
| 0.1.9 | 插件启用/禁用 API | `GET/PUT /api/plugins` 列出和切换插件状态 | 0.5d |

### 0.2 前端插件框架

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 0.2.1 | 插件路由加载器 | `PluginRouter.jsx`，从 `/api/plugins/manifests` 获取并注册路由 | 1d |
| 0.2.2 | 插件侧边栏菜单 | `PluginSidebar.jsx`，动态渲染插件注册的菜单项 | 0.5d |
| 0.2.3 | 插件市场页面 | `/plugins` 页面，展示已安装插件列表，启用/禁用开关 | 1d |
| 0.2.4 | 新手/高级模式切换 | 全局 UI 模式设置，存入 settings | 0.5d |

### 0.3 测试与文档

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 0.3.1 | 插件框架单元测试 | Manager/EventBus/ConfigStore 测试 | 1d |
| 0.3.2 | 示例插件 | 创建 hello-world 示例插件验证框架可用性 | 0.5d |
| 0.3.3 | 插件开发文档 | 如何创建一个插件的指南 | 0.5d |

**Phase 0 合计: ~9.5 人天**

---

## Phase 1: Docker 管理插件

> 目标: 实现 Docker/Compose 管理，简单模式+高级模式

### 1.1 后端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 1.1.1 | Docker Client 封装 | 封装 Docker Engine API，连接 docker.sock | 1d |
| 1.1.2 | Stack (Compose) 管理 | 创建/启动/停止/重启/更新/删除 Stack，存储 compose 文件 | 2d |
| 1.1.3 | 容器管理 API | 列出/启停/重启/删除/日志/stats | 1d |
| 1.1.4 | 镜像管理 API | 列出/拉取/删除/搜索 | 0.5d |
| 1.1.5 | 网络+卷管理 | 列出/创建/删除 | 0.5d |
| 1.1.6 | 容器日志 WebSocket | 实时日志流 | 0.5d |
| 1.1.7 | 插件注册 | 实现 Plugin 接口，注册路由和模型 | 0.5d |

### 1.2 前端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 1.2.1 | Docker 总览页 (简单模式) | Stack 列表卡片，一键操作按钮 | 1.5d |
| 1.2.2 | Stack 创建向导 | 选择应用/上传 Compose/粘贴 YAML | 1d |
| 1.2.3 | 容器管理页 (高级模式) | 容器列表表格，状态、操作、资源监控 | 1d |
| 1.2.4 | 镜像/网络/卷页面 | 高级模式下的对象管理 | 1d |
| 1.2.5 | 容器日志查看器 | 实时日志 + 搜索 + 下载 | 0.5d |
| 1.2.6 | 模式切换 | 简单/高级模式 UI 切换 | 0.5d |

**Phase 1 合计: ~11 人天**

---

## Phase 2: 项目部署插件

> 目标: 支持 Node.js/PHP/Go 项目源码部署

### 2.1 后端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 2.1.1 | Git 克隆模块 | 支持 HTTPS/SSH，Deploy Key 管理 | 1d |
| 2.1.2 | 框架自动检测 | 分析 package.json/go.mod/composer.json 判断框架和构建命令 | 1d |
| 2.1.3 | 构建流水线 | 可配置的多步骤构建: clone → install → build → start | 2d |
| 2.1.4 | 进程管理 | 使用 systemd user service 管理项目进程 | 1d |
| 2.1.5 | 构建日志 (实时) | WebSocket 推送构建输出 | 0.5d |
| 2.1.6 | 环境变量管理 | 加密存储 .env，注入到构建和运行环境 | 0.5d |
| 2.1.7 | 版本管理+回滚 | 保留最近 N 个构建版本，支持一键回滚 | 1d |
| 2.1.8 | Webhook 自动部署 | Git push 触发自动重新构建 | 0.5d |
| 2.1.9 | 自动反代配置 | 部署成功后调用 CoreAPI 创建 Host | 0.5d |

### 2.2 前端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 2.2.1 | 项目列表页 | 卡片/列表视图，状态指示，快捷操作 | 1d |
| 2.2.2 | 创建项目向导 | 4 步向导 (框架→部署方式→域名→增强选项) | 1.5d |
| 2.2.3 | 项目详情页 | 日志/环境变量/版本历史/Webhook 配置 | 1.5d |
| 2.2.4 | 实时构建日志 | WebSocket 连接，终端风格输出 | 0.5d |

**Phase 2 合计: ~12.5 人天**

---

## Phase 3: AI 助手插件

> 目标: 面板内 AI 对话、错误诊断、Text-to-Template

### 3.1 后端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 3.1.1 | LLM Client | OpenAI-compatible API 客户端，支持 SSE 流式 | 1d |
| 3.1.2 | AI 配置管理 | Base URL / Key (AES-GCM) / Model 存储和验证 | 0.5d |
| 3.1.3 | Chat API (SSE) | POST /chat 接口，流式响应 | 1d |
| 3.1.4 | Context Collector | 自动收集页面上下文、错误日志、系统状态 | 1d |
| 3.1.5 | Text-to-Template | 自然语言 → Docker Compose，含安全校验 | 1d |
| 3.1.6 | 错误诊断 API | 传入日志，AI 返回诊断+修复建议 | 0.5d |
| 3.1.7 | 对话历史存储 | 保存/加载/删除对话 | 0.5d |

### 3.2 前端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 3.2.1 | AI 对话框组件 | 右下角浮动，Markdown 渲染，流式输出 | 1.5d |
| 3.2.2 | AI 配置页 | LLM 设置表单 + 连通性测试 | 0.5d |
| 3.2.3 | 「问 AI」按钮 | 向导/配置项旁的上下文感知 AI 按钮 | 0.5d |
| 3.2.4 | Template 预览 | AI 生成的 Compose YAML 预览+编辑+部署 | 0.5d |

**Phase 3 合计: ~8.5 人天**

---

## Phase 4: 文件管理器 + Web 终端

### 4.1 后端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 4.1.1 | 文件操作 API | 列出/读取/写入/上传/下载/删除/重命名/权限 | 1.5d |
| 4.1.2 | 文件上传 (分片) | 大文件分片上传 + 合并 | 0.5d |
| 4.1.3 | 压缩/解压 | tar.gz / zip 支持 | 0.5d |
| 4.1.4 | WebSocket 终端 | PTY + xterm.js 通信 | 1d |
| 4.1.5 | 终端安全 | 仅 admin 可用，session 管理 | 0.5d |

### 4.2 前端

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 4.2.1 | 文件管理器 UI | 双栏布局，左侧目录树 + 右侧文件列表 | 1.5d |
| 4.2.2 | 文件在线编辑 | CodeMirror 集成，语法高亮，保存 | 0.5d |
| 4.2.3 | 文件拖拽上传 | 拖拽 + 进度条 + 分片 | 0.5d |
| 4.2.4 | Web 终端 UI | xterm.js + 多标签 + 自适应大小 | 1d |

**Phase 4 合计: ~8 人天**

---

## Phase 5: 数据库管理插件

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 5.1 | 数据库实例管理 | 通过 Docker 创建/启停 MySQL/PG/Redis/MariaDB | 1.5d |
| 5.2 | 数据库/用户 CRUD | 创建数据库、用户、授权 (通过 SQL 客户端) | 1.5d |
| 5.3 | 连接信息展示 | 自动生成连接字符串、端口映射 | 0.5d |
| 5.4 | 前端管理页面 | 实例列表、创建向导、连接信息、基础操作 | 1.5d |
| 5.5 | SQLite 浏览器 | 本地 SQLite 文件查看 (轻量) | 0.5d |
| 5.6 | Turso/LibSQL 支持 | Docker 部署 + 远程连接配置 | 0.5d |

**Phase 5 合计: ~6 人天**

---

## Phase 6: 备份 + 系统监控

### 6.1 备份插件 (Kopia)

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 6.1.1 | Kopia CLI 封装 | 初始化仓库、创建快照、恢复、列出快照 | 1d |
| 6.1.2 | 备份目标配置 | S3 / WebDAV / 本地 / SFTP 配置管理 | 1d |
| 6.1.3 | 定时备份调度 | cron 表达式 + 保留策略 | 0.5d |
| 6.1.4 | 备份范围管理 | 面板数据 / 项目 / Docker 卷 / 数据库 dump | 1d |
| 6.1.5 | 前端备份管理 | 备份任务列表、创建备份、恢复向导 | 1d |

### 6.2 监控插件

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 6.2.1 | 系统指标采集 | gopsutil 采集 CPU/MEM/Disk/Net | 0.5d |
| 6.2.2 | 指标存储+聚合 | SQLite 分钟级聚合，自动清理 | 0.5d |
| 6.2.3 | 告警规则引擎 | 阈值检查 + Webhook/Email 通知 | 1d |
| 6.2.4 | 前端监控仪表盘 | Recharts 实时图表 + 历史数据 | 1.5d |
| 6.2.5 | Docker 容器监控 | 每容器 CPU/MEM stats | 0.5d |

**Phase 6 合计: ~8.5 人天**

---

## Phase 7: 应用商店 + 模板市场

### 7.1 应用商店

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 7.1.1 | Runtipi 模板解析器 | 解析 config.json + docker-compose.yml 格式 | 1d |
| 7.1.2 | 应用源管理 | 内置+自定义 Git 仓库源，定期同步 | 1d |
| 7.1.3 | 应用安装流程 | 参数表单 → 渲染 compose → 启动 Stack | 1d |
| 7.1.4 | 前端应用商店 | 分类浏览、搜索、详情、安装向导 | 1.5d |
| 7.1.5 | 应用更新检测 | 检查上游镜像版本 | 0.5d |

### 7.2 项目模板市场

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 7.2.1 | 模板格式定义 | Next.js/Nuxt/Laravel/Gin 等模板结构 | 0.5d |
| 7.2.2 | 模板仓库同步 | GitHub 仓库同步 + 本地缓存 | 0.5d |
| 7.2.3 | 从模板创建项目 | fork 模板 → 部署 (集成 plugin-deploy) | 1d |
| 7.2.4 | 前端模板市场 | 模板浏览、预览、一键部署 | 1d |

**Phase 7 合计: ~8 人天**

---

## Phase 8: MCP Server + 体验打磨

### 8.1 MCP Server

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 8.1.1 | MCP Server 协议实现 | 实现 MCP 协议，暴露 Tool 列表 | 1.5d |
| 8.1.2 | Deploy Tool | deploy_project / list_projects / get_status 等 | 1d |
| 8.1.3 | Docker Tool | create_stack / list_stacks 等 | 0.5d |
| 8.1.4 | 管理 Tool | add_domain / create_database 等 | 0.5d |
| 8.1.5 | MCP 安全 | API Token 认证，权限控制 | 0.5d |

### 8.2 体验打磨

| ID | 任务 | 描述 | 预估 |
|----|------|------|------|
| 8.2.1 | 新手引导 | 首次使用引导流程 (Tour) | 1d |
| 8.2.2 | 内嵌文档 | 常见场景简短文档 + 示例项目 | 1d |
| 8.2.3 | 一键安装 Pro | 安装脚本支持 Lite/Pro 选择 | 0.5d |
| 8.2.4 | 国际化补全 | 所有新增插件的 EN/ZH 翻译 | 1d |
| 8.2.5 | E2E 测试 | 核心流程 E2E 测试 | 1.5d |
| 8.2.6 | 性能优化 | 内存占用优化，确保 2GB 可跑 | 1d |

**Phase 8 合计: ~10 人天**

---

## 里程碑总览

| 里程碑 | 包含 Phase | 核心交付 | 累计人天 |
|--------|-----------|---------|---------|
| **M0: 插件框架** | Phase 0 | 插件系统可用，Lite 功能不受影响 | 9.5 |
| **M1: Docker MVP** | Phase 0+1 | Lite + Docker 管理 | 20.5 |
| **M2: 部署 MVP** | +Phase 2 | + 项目源码部署 | 33 |
| **M3: AI MVP** | +Phase 3 | + AI 助手 (差异化核心) | 41.5 |
| **M4: 工具补全** | +Phase 4+5 | + 文件管理/终端/数据库 | 55.5 |
| **M5: 运维能力** | +Phase 6 | + 备份/监控 | 64 |
| **M6: 生态建设** | +Phase 7 | + 应用商店/模板市场 | 72 |
| **M7: Pro 完整版** | +Phase 8 | + MCP/体验打磨 → Pro 发布 | 82 |

---

## 开发原则

1. **插件先行**: 每个新功能都必须以插件形式实现，不直接修改核心代码
2. **Lite 零影响**: 不安装任何插件时，面板行为与现在完全一致
3. **渐进交付**: 每个 Phase 结束都可以发布一个可用版本
4. **AI 优先**: AI 相关功能优先于传统面板功能
5. **内存敏感**: 每个插件的内存开销需要 benchmark，确保全部加载 < 512MB
6. **安全默认**: 所有面向用户代码执行的功能默认安全隔离
7. **测试覆盖**: 新增代码测试覆盖率 > 60%
